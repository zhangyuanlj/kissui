!function(a,b,c){"use strict";var g,h,f,i,d=a(b),e=b.Modernizr;e.addTest("csstransformspreserve3d",function(){var d,a=e.prefixed("transformStyle"),c="preserve-3d";return a?(a=a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-"),e.testStyles("#modernizr{"+a+":"+c+";}",function(c){d=b.getComputedStyle?getComputedStyle(c,null).getPropertyValue(a):""}),d===c):!1}),f=a.event,g=f.special.debouncedresize={setup:function(){a(this).on("resize",g.handler)},teardown:function(){a(this).off("resize",g.handler)},handler:function(a,b){var c=this,d=arguments,e=function(){a.type="debouncedresize",f.dispatch.apply(c,d)};h&&clearTimeout(h),b?e():h=setTimeout(e,g.threshold)},threshold:150},a.BookBlock=function(b,c){this.$el=a(c),this._init(b)},a.BookBlock.defaults={orientation:"vertical",direction:"ltr",speed:1e3,easing:"ease-in-out",shadows:!0,shadowSides:.2,shadowFlip:.1,circular:!1,nextEl:"",prevEl:"",autoplay:!1,interval:3e3,onEndFlip:function(){return!1},onBeforeFlip:function(){return!1}},a.BookBlock.prototype={_init:function(b){this.options=a.extend(!0,{},a.BookBlock.defaults,b),this.$el.addClass("bb-"+this.options.orientation),this.$items=this.$el.children(".bb-item").hide(),this.itemsCount=this.$items.length,this.current=0,this.previous=-1,this.$current=this.$items.eq(this.current).show(),this.elWidth=this.$el.width();var c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=c[e.prefixed("transition")]+".bookblock",this.support=e.csstransitions&&e.csstransforms3d&&e.csstransformspreserve3d,this._initEvents(),this.options.autoplay&&(this.options.circular=!0,this._startSlideshow())},_initEvents:function(){var b=this;""!==this.options.nextEl&&a(this.options.nextEl).on("click.bookblock touchstart.bookblock",function(){return b._action("next"),!1}),""!==this.options.prevEl&&a(this.options.prevEl).on("click.bookblock touchstart.bookblock",function(){return b._action("prev"),!1}),d.on("debouncedresize",function(){b.elWidth=b.$el.width()})},_action:function(a,b){this._stopSlideshow(),this._navigate(a,b)},_navigate:function(a,b){return this.isAnimating?!1:(this.options.onBeforeFlip(this.current),this.isAnimating=!0,this.$current=this.$items.eq(this.current),b!==c?this.current=b:"next"===a&&"ltr"===this.options.direction||"prev"===a&&"rtl"===this.options.direction?this.options.circular||this.current!==this.itemsCount-1?(this.previous=this.current,this.current=this.current<this.itemsCount-1?this.current+1:0):this.end=!0:("prev"===a&&"ltr"===this.options.direction||"next"===a&&"rtl"===this.options.direction)&&(this.options.circular||0!==this.current?(this.previous=this.current,this.current=this.current>0?this.current-1:this.itemsCount-1):this.end=!0),this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current),this.support?this._layout(a):this._layoutNoSupport(a),void 0)},_layoutNoSupport:function(a){this.$items.hide(),this.$nextItem.show(),this.end=!1,this.isAnimating=!1;var b="next"===a&&this.current===this.itemsCount-1||"prev"===a&&0===this.current;this.options.onEndFlip(this.previous,this.current,b,a)},_layout:function(b){var l,m,n,o,c=this,d=this._addSide("left",b),e=this._addSide("middle",b),f=this._addSide("right",b),g=d.find("div.bb-overlay"),h=e.find("div.bb-flipoverlay:first"),i=e.find("div.bb-flipoverlay:last"),j=f.find("div.bb-overlay"),k=this.end?400:this.options.speed;this.$items.hide(),this.$el.prepend(d,e,f),e.css({transitionDuration:k+"ms",transitionTimingFunction:this.options.easing}).on(this.transEndEventName,function(d){if(a(d.target).hasClass("bb-page")){c.$el.children(".bb-page").remove(),c.$nextItem.show(),c.end=!1,c.isAnimating=!1;var e="next"===b&&c.current===c.itemsCount-1||"prev"===b&&0===c.current;c.options.onEndFlip(c.previous,c.current,e,b)}}),"prev"===b&&e.addClass("bb-flip-initial"),this.options.shadows&&!this.end&&(l="next"===b?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides},m="next"===b?{transition:"opacity "+this.options.speed/2+"ms "+"linear"}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip},n="next"===b?{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"},o="next"===b?{transition:"opacity "+this.options.speed/2+"ms "+"linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms "+"linear"+" "+this.options.speed/2+"ms"},h.css(m),i.css(n),g.css(l),j.css(o)),setTimeout(function(){e.addClass(c.end?"bb-flip-"+b+"-end":"bb-flip-"+b),c.options.shadows&&!c.end&&(h.css({opacity:"next"===b?c.options.shadowFlip:0}),i.css({opacity:"next"===b?0:c.options.shadowFlip}),g.css({opacity:"next"===b?c.options.shadowSides:0}),j.css({opacity:"next"===b?0:c.options.shadowSides}))},25)},_addSide:function(b,c){var d;switch(b){case"left":d=a('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===c?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case"middle":d=a('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===c?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===c?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103);break;case"right":d=a('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content"><div class="bb-inner">'+("next"===c?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101)}return d},_startSlideshow:function(){var a=this;this.slideshow=setTimeout(function(){a._navigate("next"),a.options.autoplay&&a._startSlideshow()},this.options.interval)},_stopSlideshow:function(){this.options.autoplay&&(clearTimeout(this.slideshow),this.options.autoplay=!1)},next:function(){this._action("ltr"===this.options.direction?"next":"prev")},prev:function(){this._action("ltr"===this.options.direction?"prev":"next")},jump:function(a){if(a-=1,a===this.current||a>=this.itemsCount||0>a)return!1;var b;b="ltr"===this.options.direction?a>this.current?"next":"prev":a>this.current?"prev":"next",this._action(b,a)},last:function(){this.jump(this.itemsCount)},first:function(){this.jump(1)},isActive:function(){return this.isAnimating},update:function(){var a=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=a.index()},destroy:function(){this.options.autoplay&&this._stopSlideshow(),this.$el.removeClass("bb-"+this.options.orientation),this.$items.show(),""!==this.options.nextEl&&a(this.options.nextEl).off(".bookblock"),""!==this.options.prevEl&&a(this.options.prevEl).off(".bookblock"),d.off("debouncedresize")}},i=function(a){b.console&&b.console.error(a)},a.fn.bookblock=function(b){if("string"==typeof b){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=a.data(this,"bookblock");return d?a.isFunction(d[b])&&"_"!==b.charAt(0)?(d[b].apply(d,c),void 0):(i("no such method '"+b+"' for bookblock instance"),void 0):(i("cannot call methods on bookblock prior to initialization; attempted to call method '"+b+"'"),void 0)})}else this.each(function(){var c=a.data(this,"bookblock");c?c._init():c=a.data(this,"bookblock",new a.BookBlock(b,this))});return this}}(jQuery,window);